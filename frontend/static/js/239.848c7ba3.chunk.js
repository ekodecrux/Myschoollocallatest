"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[239],{7239(e,t,s){s.d(t,{A:()=>we});var i=s(89379),n=s(65043),r=s(79456),o=s(45685),l=s(46946),a=s(94496),c=s(72882),d=s(65204),h=s(19955),x=s(40360),m=s(8591),u=s(39336),g=s(78632),p=s(17434),A=s(94814),v=s(42788),f=s(71062),j=s(80216),y=s(71716),w=s(48734),b=s(97334),k=s(59314),C=s(63844),z=s(69392),S=s(25142),E=s(17642),L=s(84511),I=s(83462),T=s(26600),W=s(97368),R=s(92064),M=s(59064),D=s(71861),H=s(66734),N=s(70579);const F=(0,H.A)((0,N.jsx)("path",{d:"M2 4h20v16H2z"}),"Rectangle"),V=(0,H.A)((0,N.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),P=(0,H.A)((0,N.jsx)("path",{d:"M12 7.77 18.39 18H5.61zM12 4 2 20h20z"}),"ChangeHistory"),O=(0,H.A)((0,N.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),B=(0,H.A)((0,N.jsx)("path",{d:"M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 10H3V8h2v4h2V8h2v4h2V8h2v4h2V8h2v4h2V8h2z"}),"Straighten");var G=s(78994);const U=(0,H.A)((0,N.jsx)("path",{d:"M2.5 4v3h5v12h3V7h5V4zm19 5h-9v3h3v7h3v-7h3z"}),"TextFields"),X=(0,H.A)((0,N.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload");var Y=s(51387),q=s(79484);const Z=(0,H.A)((0,N.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3zm-3-7V3.5L18.5 9z"}),"NoteAdd"),_=(0,H.A)((0,N.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),J=(0,H.A)((0,N.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo");var K=s(30079);const Q=(0,H.A)((0,N.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),$=(0,H.A)([(0,N.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,N.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),ee=(0,H.A)((0,N.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M8 20H4v-4h4zm0-6H4v-4h4zm0-6H4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4z"}),"GridOn");var te=s(30513),se=s(37141);const ie=(0,H.A)((0,N.jsx)("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"}),"FolderOpen");var ne=s(47968);const re=(0,H.A)((0,N.jsx)("path",{d:"M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42M10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5"}),"FormatBold"),oe=(0,H.A)((0,N.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"}),"FormatItalic"),le=(0,H.A)((0,N.jsx)("path",{d:"M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"}),"FormatAlignLeft"),ae=(0,H.A)((0,N.jsx)("path",{d:"M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"}),"FormatAlignCenter"),ce=(0,H.A)((0,N.jsx)("path",{d:"M3 21h18v-2H3zm6-4h12v-2H9zm-6-4h18v-2H3zm6-4h12V7H9zM3 3v2h18V3z"}),"FormatAlignRight"),de=(0,H.A)((0,N.jsx)("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm2 4v-2H3c0 1.1.89 2 2 2M3 9h2V7H3zm12 12h2v-2h-2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 12H9V5h10zm-8 6h2v-2h-2zm-4 0h2v-2H7z"}),"FlipToFront"),he=(0,H.A)((0,N.jsx)("path",{d:"M9 7H7v2h2zm0 4H7v2h2zm0-8c-1.11 0-2 .9-2 2h2zm4 12h-2v2h2zm6-12v2h2c0-1.1-.9-2-2-2m-6 0h-2v2h2zM9 17v-2H7c0 1.1.89 2 2 2m10-4h2v-2h-2zm0-4h2V7h-2zm0 8c1.1 0 2-.9 2-2h-2zM5 7H3v12c0 1.1.89 2 2 2h12v-2H5zm10-2h2V3h-2zm0 12h2v-2h-2z"}),"FlipToBack");var xe=s(36910);const me=(0,H.A)((0,N.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),ue=(0,H.A)((0,N.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen");var ge=s(65239),pe=s.n(ge);const Ae={TEXT:"text",IMAGE:"image",RECTANGLE:"rectangle",CIRCLE:"circle",TRIANGLE:"triangle",LINE:"line",STAR:"star",ARROW:"arrow"},ve={A3:{width:842,height:1191,label:"A3 (297\xd7420mm)"},A4:{width:595,height:842,label:"A4 (210\xd7297mm)"},A5:{width:420,height:595,label:"A5 (148\xd7210mm)"},Letter:{width:612,height:792,label:'Letter (8.5\xd711")'},Square:{width:600,height:600,label:"Square (600\xd7600)"},Social:{width:1080,height:1080,label:"Social (1080\xd71080)"},Custom:{width:800,height:600,label:"Custom"}},fe=["#000000","#ffffff","#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722"],je=["Arial","Helvetica","Times New Roman","Georgia","Verdana","Trebuchet MS","Comic Sans MS","Impact","Courier New","Roboto"],ye=(0,n.forwardRef)((e,t)=>{let{makerType:s="chart",templates:H=[],onSave:ge,onLoad:ye}=e;const{isLoggedin:we,accessToken:be}=(0,r.d4)(e=>e.login),[ke,Ce]=((0,o.Zp)(),(0,n.useState)("A4")),[ze,Se]=(0,n.useState)({width:800,height:600}),[Ee,Le]=(0,n.useState)("#ffffff"),[Ie,Te]=(0,n.useState)(80),[We,Re]=(0,n.useState)(!1),[Me,De]=(0,n.useState)([]),[He,Ne]=(0,n.useState)(null),[Fe,Ve]=(0,n.useState)([]),[Pe,Oe]=(0,n.useState)(-1),[Be,Ge]=(0,n.useState)(!1),[Ue,Xe]=(0,n.useState)({x:0,y:0}),[Ye,qe]=(0,n.useState)({x:0,y:0}),Ze=(0,n.useRef)(!1),[_e,Je]=(0,n.useState)(!1),[Ke,Qe]=(0,n.useState)(null),[$e,et]=(0,n.useState)({x:0,y:0,width:0,height:0,elementX:0,elementY:0}),[tt,st]=(0,n.useState)(0),[it,nt]=(0,n.useState)(null),[rt,ot]=(0,n.useState)(null),[lt,at]=(0,n.useState)({open:!1,message:"",severity:"success"}),[ct,dt]=(0,n.useState)(!1),[ht,xt]=(0,n.useState)(!1),[mt,ut]=(0,n.useState)(""),[gt,pt]=(0,n.useState)([]),[At,vt]=(0,n.useState)(!1),[ft,jt]=(0,n.useState)([]),[yt,wt]=(0,n.useState)("ANIMALS"),[bt,kt]=(0,n.useState)(!1),[Ct,zt]=(0,n.useState)(""),St=(0,n.useRef)(null),Et=(0,n.useRef)(null),Lt=(0,n.useRef)(null),It=()=>"Custom"===ke?ze:ve[ke]||ve.A4,Tt=(0,n.useCallback)(async()=>{if(we&&be){vt(!0);try{const e="https://portal.myschoolct.com",t=await fetch("".concat(e,"/api/rest/templates/list?makerType=").concat(s),{headers:{Authorization:"Bearer ".concat(be)}});if(t.ok){const e=await t.json();pt(e.templates||[])}}catch(e){console.error("Error fetching templates:",e)}vt(!1)}},[we,be,s]);(0,n.useEffect)(()=>{Tt()},[Tt]);const Wt=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e||e.length<2)jt([]);else{kt(!0);try{const t="https://portal.myschoolct.com",s=await fetch("".concat(t,"/api/rest/search/global?query=").concat(encodeURIComponent(e),"&size=50"));if(s.ok){let e=((await s.json()).results||[]).map(e=>e.path).filter(e=>e&&(e.toLowerCase().endsWith(".jpg")||e.toLowerCase().endsWith(".png")||e.toLowerCase().endsWith(".jpeg")||e.toLowerCase().endsWith(".gif")));jt(e)}}catch(t){console.error("Error fetching images:",t)}kt(!1)}},[]);(0,n.useEffect)(()=>{if(2===tt){const e=setTimeout(()=>{Wt(Ct)},500);return()=>clearTimeout(e)}},[Ct,tt,Wt]),(0,n.useEffect)(()=>{const e=e=>{if(!He||He.locked)return;if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.isContentEditable)return;const t=e.shiftKey?10:1;let s=He.x,i=He.y,n=!1;switch(e.key){case"ArrowUp":i=He.y-t,n=!0,e.preventDefault();break;case"ArrowDown":i=He.y+t,n=!0,e.preventDefault();break;case"ArrowLeft":s=He.x-t,n=!0,e.preventDefault();break;case"ArrowRight":s=He.x+t,n=!0,e.preventDefault();break;case"Delete":case"Backspace":e.target.tagName.match(/INPUT|TEXTAREA/)||(Ut(He.id),e.preventDefault());break;case"Escape":Ne(null),e.preventDefault()}n&&Gt(He.id,{x:s,y:i})};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[He,Me]);const Rt=(0,n.useCallback)(e=>{const t=Fe.slice(0,Pe+1);t.push(JSON.stringify(e)),Ve(t),Oe(t.length-1)},[Fe,Pe]),Mt=(e,t)=>{_e||(e.stopPropagation(),Ne(t),t.locked||(Ge(!0),Xe({x:e.clientX,y:e.clientY}),qe({x:t.x,y:t.y})))},Dt=(0,n.useCallback)(e=>{if(_e)return;if(!Be||!He)return;const t=e.clientX-Ue.x,s=e.clientY-Ue.y,i=Ie/100,n=Ye.x+t/i,r=Ye.y+s/i;Gt(He.id,{x:n,y:r})},[Be,_e,He,Ue,Ye,Ie]),Ht=(0,n.useCallback)(()=>{Be&&He&&(Rt(Me),Ze.current=!0,setTimeout(()=>{Ze.current=!1},100)),Ge(!1)},[Be,He,Me,Rt]);(0,n.useEffect)(()=>{if(Be)return window.addEventListener("mousemove",Dt),window.addEventListener("mouseup",Ht),()=>{window.removeEventListener("mousemove",Dt),window.removeEventListener("mouseup",Ht)}},[Be,Dt,Ht]);const Nt=(0,n.useCallback)(e=>{if(!_e||!He||!Ke)return;const t=Ie/100,s=(e.clientX-$e.x)/t,i=(e.clientY-$e.y)/t;let n=$e.width,r=$e.height,o=$e.elementX,l=$e.elementY;Ke.includes("e")&&(n=Math.max(20,$e.width+s)),Ke.includes("w")&&(n=Math.max(20,$e.width-s),o=$e.elementX+s),Ke.includes("s")&&(r=Math.max(20,$e.height+i)),Ke.includes("n")&&(r=Math.max(20,$e.height-i),l=$e.elementY+i),Gt(He.id,{width:n,height:r,x:o,y:l})},[_e,He,Ke,$e,Ie]),Ft=(0,n.useCallback)(()=>{_e&&He&&(Rt(Me),Ze.current=!0,setTimeout(()=>{Ze.current=!1},100)),Je(!1),Qe(null)},[_e,He,Me,Rt]);(0,n.useEffect)(()=>{if(_e)return window.addEventListener("mousemove",Nt),window.addEventListener("mouseup",Ft),()=>{window.removeEventListener("mousemove",Nt),window.removeEventListener("mouseup",Ft)}},[_e,Nt,Ft]);const Vt=e=>{if(!He||He.id!==e.id||e.locked)return null;const t={position:"absolute",width:14,height:14,backgroundColor:"#1976d2",border:"2px solid white",borderRadius:2,zIndex:9999,boxShadow:"0 2px 4px rgba(0,0,0,0.3)",pointerEvents:"auto"};return[{key:"nw",style:{top:-7,left:-7,cursor:"nw-resize"}},{key:"ne",style:{top:-7,right:-7,cursor:"ne-resize"}},{key:"sw",style:{bottom:-7,left:-7,cursor:"sw-resize"}},{key:"se",style:{bottom:-7,right:-7,cursor:"se-resize"}},{key:"n",style:{top:-7,left:"50%",transform:"translateX(-50%)",cursor:"n-resize"}},{key:"s",style:{bottom:-7,left:"50%",transform:"translateX(-50%)",cursor:"s-resize"}},{key:"e",style:{right:-7,top:"50%",transform:"translateY(-50%)",cursor:"e-resize"}},{key:"w",style:{left:-7,top:"50%",transform:"translateY(-50%)",cursor:"w-resize"}}].map(s=>(0,N.jsx)(l.A,{sx:(0,i.A)((0,i.A)({},t),s.style),onMouseDown:t=>{t.stopPropagation(),t.preventDefault(),((e,t,s)=>{e.stopPropagation(),e.preventDefault(),Ge(!1),Je(!0),Qe(t),et({x:e.clientX,y:e.clientY,width:s.width,height:s.height,elementX:s.x,elementY:s.y})})(t,s.key,e)}},s.key))},Pt=()=>{De([]),Ne(null),Ve([]),Oe(-1),at({open:!0,message:"Canvas cleared!",severity:"info"})},Ot=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=It(),n="".concat(e,"-").concat(Date.now());let r=(0,i.A)({},t);if(e===Ae.IMAGE&&t.src&&!t.src.startsWith("data:"))try{at({open:!0,message:"Loading image...",severity:"info"});const e=await(async e=>{try{const t="".concat("https://portal.myschoolct.com","/api/rest/images/proxy?url=").concat(encodeURIComponent(e)),s=await fetch(t);if(!s.ok)throw new Error("Failed to fetch image");const i=await s.blob();return new Promise((e,t)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=t,s.readAsDataURL(i)})}catch(t){return console.warn("Could not convert to base64, using original URL:",t),e}})(t.src);r.src=e,r.originalSrc=t.src}catch(a){console.warn("Failed to convert image to base64:",a)}const o=(0,i.A)((0,i.A)({id:n,type:e,x:s.width/2-50,y:s.height/2-25,width:"text"===e?200:100,height:"text"===e?50:100,rotation:0,locked:!1},Bt(e)),r),l=[...Me,o];De(l),Ne(o),Rt(l)},Bt=e=>{switch(e){case Ae.TEXT:return{text:"Enter text here",fontSize:24,fontFamily:"Arial",color:"#000000",bold:!1,italic:!1,align:"center"};case Ae.RECTANGLE:return{fill:"#2196f3",stroke:"#1976d2",strokeWidth:2};case Ae.CIRCLE:return{fill:"#4caf50",stroke:"#388e3c",strokeWidth:2};case Ae.TRIANGLE:return{fill:"#ff9800",stroke:"#f57c00",strokeWidth:2};case Ae.STAR:return{fill:"#ffeb3b",stroke:"#fbc02d",strokeWidth:2,points:5};case Ae.LINE:case Ae.ARROW:return{stroke:"#000000",strokeWidth:3,width:150,height:4};case Ae.IMAGE:return{src:"",width:150,height:150};default:return{}}},Gt=(e,t)=>{const s=Me.map(s=>s.id===e?(0,i.A)((0,i.A)({},s),t):s);De(s),(null===He||void 0===He?void 0:He.id)===e&&Ne((0,i.A)((0,i.A)({},He),t))},Ut=e=>{const t=Me.filter(t=>t.id!==e);De(t),Ne(null),Rt(t)},Xt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const s=Me.find(t=>t.id===e);s&&!s.locked&&(Gt(e,{rotation:(s.rotation||0)+t}),Rt(Me.map(s=>s.id===e?(0,i.A)((0,i.A)({},s),{},{rotation:(s.rotation||0)+t}):s)))},Yt=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{Ot(Ae.IMAGE,{src:e.target.result}),at({open:!0,message:"Image uploaded successfully!",severity:"success"})},e.onerror=()=>{at({open:!0,message:"Failed to load image",severity:"error"})},e.readAsDataURL(t)}e.target.value=""},qt=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";if(St.current)try{const t=He;Ne(null),await new Promise(e=>setTimeout(e,100));const i=St.current.querySelectorAll("img"),n=[];await Promise.all(Array.from(i).map(async(e,t)=>{if(n[t]=e.src,e.src&&!e.src.startsWith("data:"))try{const t=document.createElement("canvas"),s=t.getContext("2d"),i=new Image;i.crossOrigin="anonymous",await new Promise((n,r)=>{i.onload=()=>{t.width=i.naturalWidth||i.width,t.height=i.naturalHeight||i.height,s.drawImage(i,0,0);try{e.src=t.toDataURL("image/png")}catch(r){console.warn("Could not convert image to base64:",r)}n()},i.onerror=()=>{console.warn("Failed to load image for conversion"),n()},i.src=e.src+(e.src.includes("?")?"&":"?")+"_t="+Date.now()})}catch(s){console.warn("Image conversion error:",s)}}));const r=await pe()(St.current,{scale:2,backgroundColor:Ee,useCORS:!0,allowTaint:!1,logging:!1,imageTimeout:3e4,foreignObjectRendering:!1,removeContainer:!0,onclone:(e,t)=>{e.querySelectorAll('[style*="z-index: 9999"]').forEach(e=>e.remove());e.querySelectorAll('[style*="outline"]').forEach(e=>e.style.outline="none");t.querySelectorAll("img").forEach(e=>{e.crossOrigin="anonymous",e.style.visibility="visible"})}});i.forEach((e,t)=>{n[t]&&(e.src=n[t])});const o=document.createElement("a");o.download="".concat(s,"-design-").concat(Date.now(),".").concat(e),o.href="jpg"===e||"jpeg"===e?r.toDataURL("image/jpeg",.9):r.toDataURL("image/png"),document.body.appendChild(o),o.click(),document.body.removeChild(o),t&&Ne(t),at({open:!0,message:"Design exported successfully!",severity:"success"})}catch(t){console.error("Export error:",t),at({open:!0,message:"Export failed: ".concat(t.message,". Try using smaller images or check image permissions."),severity:"error"})}else at({open:!0,message:"Canvas not ready",severity:"error"})},Zt=async()=>{if(St.current)try{Ne(null),await new Promise(e=>setTimeout(e,100));const e=St.current.querySelectorAll("img"),t=[];await Promise.all(Array.from(e).map(async(e,s)=>{if(t[s]=e.src,e.src&&!e.src.startsWith("data:"))try{const t=document.createElement("canvas"),s=t.getContext("2d"),i=new Image;i.crossOrigin="anonymous",await new Promise((n,r)=>{i.onload=()=>{t.width=i.naturalWidth||i.width,t.height=i.naturalHeight||i.height,s.drawImage(i,0,0);try{e.src=t.toDataURL("image/png")}catch(r){console.warn("Could not convert image to base64:",r)}n()},i.onerror=()=>n(),i.src=e.src+(e.src.includes("?")?"&":"?")+"_t="+Date.now()})}catch(i){console.warn("Image conversion error:",i)}}));const s=await pe()(St.current,{scale:2,backgroundColor:Ee,useCORS:!0,allowTaint:!1,logging:!1,imageTimeout:3e4,onclone:(e,t)=>{e.querySelectorAll('[style*="z-index: 9999"]').forEach(e=>e.remove());e.querySelectorAll('[style*="outline"]').forEach(e=>e.style.outline="none")}});e.forEach((e,s)=>{t[s]&&(e.src=t[s])});const i=window.open("","_blank");i&&(i.document.write('\n          <!DOCTYPE html>\n          <html><head><title>Print Design</title>\n          <style>body{margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;}\n          img{max-width:100%;height:auto;}@media print{body{margin:0;}}</style>\n          </head><body><img src="'.concat(s.toDataURL(),'" /></body></html>\n        ')),i.document.close(),setTimeout(()=>{i.print(),i.close()},250))}catch(e){console.error("Print error:",e),at({open:!0,message:"Print failed. Try exporting as image first.",severity:"error"})}},_t=e=>{Ce(e.pageSize||"A4"),Se(e.customSize||{width:800,height:600}),Le(e.canvasBg||"#ffffff"),De(e.elements||[]),Ne(null),xt(!1),at({open:!0,message:"Loaded: ".concat(e.name),severity:"success"})},Jt=async e=>{if(e.toString().startsWith("seed-"))at({open:!0,message:"Cannot delete system templates",severity:"warning"});else try{const t="https://portal.myschoolct.com";(await fetch("".concat(t,"/api/rest/templates/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(be)}})).ok&&(await Tt(),at({open:!0,message:"Design deleted",severity:"success"}))}catch(t){console.error("Delete error:",t)}};(0,n.useImperativeHandle)(t,()=>({export:qt,print:Zt,clear:Pt,save:()=>dt(!0),load:()=>xt(!0)}));const Kt=It(),Qt=He,[$t,es]=("undefined"!==typeof window&&window.innerWidth,(0,n.useState)(!1));return(0,N.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:{xs:"auto",md:"calc(100vh - 120px)"},minHeight:{xs:"100vh",md:"auto"},overflow:"hidden",bgcolor:"#f0f2f5"},children:[(0,N.jsxs)(l.A,{sx:{display:{xs:"flex",md:"none"},p:1,bgcolor:"primary.main",color:"white",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsx)(a.A,{variant:"subtitle1",children:"Maker Tools"}),(0,N.jsx)(c.A,{variant:"contained",size:"small",onClick:()=>es(!$t),sx:{bgcolor:"white",color:"primary.main"},children:$t?"Hide Tools":"Show Tools"})]}),(0,N.jsxs)(d.A,{sx:{width:{xs:"100%",md:280},display:{xs:$t?"flex":"none",md:"flex"},flexDirection:"column",borderRadius:0,zIndex:10,boxShadow:2,maxHeight:{xs:"50vh",md:"none"},overflow:"auto"},children:[(0,N.jsxs)(h.A,{value:tt,onChange:(e,t)=>st(t),variant:"fullWidth",sx:{"& .MuiTab-root":{minWidth:"auto",fontSize:{xs:"0.7rem",md:"0.875rem"}}},children:[(0,N.jsx)(x.A,{label:"Elements"}),(0,N.jsx)(x.A,{label:"Templates"}),(0,N.jsx)(x.A,{label:"Images"})]}),(0,N.jsxs)(l.A,{sx:{flex:1,overflow:"auto",p:2},children:[0===tt&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,children:"Add Shapes"}),(0,N.jsxs)(m.Ay,{container:!0,spacing:1,sx:{mb:2},children:[(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.RECTANGLE),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(F,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Rect"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.CIRCLE),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(V,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Circle"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.TRIANGLE),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(P,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Triangle"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.STAR),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(O,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Star"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.LINE),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(B,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Line"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsxs)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ot(Ae.ARROW),sx:{flexDirection:"column",py:1},children:[(0,N.jsx)(G.A,{}),(0,N.jsx)(a.A,{variant:"caption",children:"Arrow"})]})})]}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,children:"Add Content"}),(0,N.jsx)(c.A,{fullWidth:!0,variant:"outlined",startIcon:(0,N.jsx)(U,{}),onClick:()=>Ot(Ae.TEXT),sx:{mb:1},children:"Add Text"}),(0,N.jsx)(c.A,{fullWidth:!0,variant:"outlined",startIcon:(0,N.jsx)(X,{}),onClick:()=>{var e;return null===(e=Et.current)||void 0===e?void 0:e.click()},children:"Upload Image"}),(0,N.jsx)("input",{ref:Et,type:"file",style:{display:"none"},accept:"image/*,.png,.jpg,.jpeg,.gif,.webp",onChange:Yt}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,children:"Page Size"}),(0,N.jsx)(g.A,{fullWidth:!0,size:"small",sx:{mb:1},children:(0,N.jsx)(p.A,{value:ke,onChange:e=>Ce(e.target.value),children:Object.entries(ve).map(e=>{let[t,s]=e;return(0,N.jsx)(A.A,{value:t,children:s.label},t)})})}),"Custom"===ke&&(0,N.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,N.jsx)(v.A,{size:"small",label:"W",type:"number",value:ze.width,onChange:e=>Se((0,i.A)((0,i.A)({},ze),{},{width:parseInt(e.target.value)||100}))}),(0,N.jsx)(v.A,{size:"small",label:"H",type:"number",value:ze.height,onChange:e=>Se((0,i.A)((0,i.A)({},ze),{},{height:parseInt(e.target.value)||100}))})]}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,children:"Background"}),(0,N.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:fe.map(e=>(0,N.jsx)(l.A,{sx:{width:24,height:24,bgcolor:e,cursor:"pointer",border:Ee===e?"2px solid #1976d2":"1px solid #ccc",borderRadius:.5},onClick:()=>Le(e)},e))})]}),1===tt&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,children:"Saved Designs"}),0===gt.length?(0,N.jsx)(a.A,{variant:"body2",color:"textSecondary",children:"No saved designs yet"}):(0,N.jsx)(f.A,{dense:!0,children:gt.map(e=>{var t;const s=e.created_at||e.createdAt;let i="";if(e.isSystem)i="System Template";else if(s)try{const e=new Date(s);i=isNaN(e.getTime())?"":e.toLocaleDateString()}catch(r){i=""}const n=e.isSystem||(null===(t=e.id)||void 0===t?void 0:t.toString().startsWith("seed-"));return(0,N.jsx)(j.Ay,{button:!0,onClick:()=>_t(e),secondaryAction:!n&&(0,N.jsx)(y.A,{edge:"end",size:"small",color:"error",onClick:t=>{t.stopPropagation(),Jt(e.id)},children:(0,N.jsx)(Y.A,{fontSize:"small"})}),children:(0,N.jsx)(w.A,{primary:e.name,secondary:i||"User Design",primaryTypographyProps:{fontWeight:n?500:400}})},e.id)})})]}),2===tt&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#1976d2"},children:"\ud83d\udcda MySchool Image Bank"}),(0,N.jsx)(v.A,{size:"small",fullWidth:!0,placeholder:"Search images (e.g., lion, elephant, tree)...",value:Ct,onChange:e=>zt(e.target.value),InputProps:{startAdornment:(0,N.jsx)(q.A,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:1}}),(0,N.jsx)(l.A,{sx:{maxHeight:300,overflowY:"auto",border:"1px solid #e0e0e0",borderRadius:1,p:1},children:bt?(0,N.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,N.jsx)(b.A,{size:24})}):Ct.length<2?(0,N.jsx)(a.A,{variant:"body2",color:"textSecondary",align:"center",sx:{py:2},children:"Type at least 2 characters to search"}):ft.length>0?(0,N.jsx)(m.Ay,{container:!0,spacing:1,children:ft.slice(0,30).map((e,t)=>(0,N.jsx)(m.Ay,{item:!0,xs:4,children:(0,N.jsx)(k.A,{sx:{cursor:"pointer","&:hover":{boxShadow:4}},onClick:()=>Ot(Ae.IMAGE,{src:e}),children:(0,N.jsx)(C.A,{component:"img",height:"60",image:e,sx:{objectFit:"contain",bgcolor:"#f5f5f5"}})})},t))}):(0,N.jsxs)(a.A,{variant:"body2",color:"textSecondary",align:"center",sx:{py:2},children:['No images found for "',Ct,'"']})}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsx)(c.A,{fullWidth:!0,variant:"outlined",startIcon:(0,N.jsx)(X,{}),onClick:()=>{var e;return null===(e=Lt.current)||void 0===e?void 0:e.click()},children:"Upload from Device"}),(0,N.jsx)("input",{ref:Lt,type:"file",style:{display:"none"},accept:"image/*,.png,.jpg,.jpeg,.gif,.webp",onChange:Yt})]})]})]}),(0,N.jsxs)(l.A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:{xs:"60vh",md:"auto"}},children:[(0,N.jsxs)(d.A,{sx:{p:{xs:.5,md:1},borderRadius:0,display:"flex",alignItems:"center",gap:{xs:.5,md:1},flexWrap:"wrap",overflowX:"auto"},children:[(0,N.jsx)(z.A,{title:"New Design",children:(0,N.jsx)(y.A,{onClick:()=>{De([]),Ne(null),Ve([]),Oe(-1),Le("#ffffff"),Ce("A4"),ut(""),at({open:!0,message:"New design created!",severity:"success"})},color:"primary",size:"small",children:(0,N.jsx)(Z,{})})}),(0,N.jsx)(u.A,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,N.jsx)(z.A,{title:"Undo",children:(0,N.jsx)("span",{children:(0,N.jsx)(y.A,{onClick:()=>{Pe>0&&(Oe(Pe-1),De(JSON.parse(Fe[Pe-1])))},disabled:Pe<=0,size:"small",children:(0,N.jsx)(_,{})})})}),(0,N.jsx)(z.A,{title:"Redo",children:(0,N.jsx)("span",{children:(0,N.jsx)(y.A,{onClick:()=>{Pe<Fe.length-1&&(Oe(Pe+1),De(JSON.parse(Fe[Pe+1])))},disabled:Pe>=Fe.length-1,size:"small",children:(0,N.jsx)(J,{})})})}),(0,N.jsx)(u.A,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,N.jsx)(z.A,{title:"Clear Canvas",children:(0,N.jsx)(y.A,{onClick:Pt,color:"error",size:"small",children:(0,N.jsx)(K.A,{})})}),(0,N.jsx)(u.A,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,N.jsx)(z.A,{title:"Zoom Out",children:(0,N.jsx)(y.A,{onClick:()=>Te(Math.max(25,Ie-10)),size:"small",children:(0,N.jsx)(Q,{})})}),(0,N.jsxs)(a.A,{sx:{minWidth:{xs:35,md:45},textAlign:"center",fontSize:{xs:"0.75rem",md:"1rem"}},children:[Ie,"%"]}),(0,N.jsx)(z.A,{title:"Zoom In",children:(0,N.jsx)(y.A,{onClick:()=>Te(Math.min(200,Ie+10)),size:"small",children:(0,N.jsx)($,{})})}),(0,N.jsx)(u.A,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,N.jsx)(z.A,{title:"Toggle Grid",children:(0,N.jsx)(y.A,{onClick:()=>Re(!We),color:We?"primary":"default",size:"small",children:(0,N.jsx)(ee,{})})}),(0,N.jsx)(u.A,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",md:"block"}}}),(0,N.jsx)(g.A,{size:"small",sx:{minWidth:{xs:70,md:100},display:{xs:"none",sm:"block"}},children:(0,N.jsxs)(p.A,{value:ke,onChange:e=>Ce(e.target.value),displayEmpty:!0,sx:{fontSize:"0.85rem"},children:[(0,N.jsx)(A.A,{value:"A3",children:"A3"}),(0,N.jsx)(A.A,{value:"A4",children:"A4"}),(0,N.jsx)(A.A,{value:"A5",children:"A5"}),(0,N.jsx)(A.A,{value:"Letter",children:"Letter"}),(0,N.jsx)(A.A,{value:"Square",children:"Square"})]})}),(0,N.jsx)(l.A,{sx:{flex:1}}),(0,N.jsxs)(l.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[(0,N.jsx)(c.A,{variant:"outlined",size:"small",startIcon:(0,N.jsx)(te.A,{}),onClick:Zt,sx:{display:{xs:"none",md:"inline-flex"},color:"#1976d2","&:hover":{color:"#000000",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Print"}),(0,N.jsx)(c.A,{variant:"outlined",size:"small",startIcon:(0,N.jsx)(se.A,{}),onClick:()=>dt(!0),sx:{fontSize:{xs:"0.7rem",md:"0.875rem"},minWidth:{xs:60,md:80},color:"#1976d2","&:hover":{color:"#000000",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Save"}),(0,N.jsx)(c.A,{variant:"outlined",size:"small",startIcon:(0,N.jsx)(ie,{}),onClick:()=>xt(!0),sx:{fontSize:{xs:"0.7rem",md:"0.875rem"},minWidth:{xs:60,md:80},color:"#1976d2","&:hover":{color:"#000000",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Load"})]}),(0,N.jsx)(z.A,{title:"Export as PNG image",children:(0,N.jsx)(c.A,{variant:"outlined",startIcon:(0,N.jsx)(ne.A,{}),onClick:()=>qt("png"),sx:{color:"#1976d2","&:hover":{color:"#000000",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Export"})})]}),(0,N.jsx)(l.A,{sx:{flex:1,overflow:"auto",display:"flex",justifyContent:"center",alignItems:"center",p:2,bgcolor:"#f5f5f5"},children:(0,N.jsx)(d.A,{ref:St,sx:{width:Kt.width*(Ie/100),height:Kt.height*(Ie/100),position:"relative",bgcolor:Ee,boxShadow:3,overflow:"hidden",backgroundImage:We?"linear-gradient(#e0e0e0 1px, transparent 1px), linear-gradient(90deg, #e0e0e0 1px, transparent 1px)":"none",backgroundSize:We?"20px 20px":"auto"},onClick:()=>{Ze.current||Ne(null)},children:Me.map(e=>(e=>{const t={position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,transform:"rotate(".concat(e.rotation||0,"deg)"),cursor:e.locked?"not-allowed":Be&&(null===He||void 0===He?void 0:He.id)===e.id?"grabbing":"grab",border:(null===He||void 0===He?void 0:He.id)===e.id?"2px dashed #1976d2":"none",boxSizing:"border-box",userSelect:"none"},s=s=>(0,N.jsxs)(l.A,{sx:(0,i.A)({},t),children:[s,Vt(e)]},e.id);switch(e.type){case Ae.TEXT:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:e.align||"center"},onMouseDown:t=>Mt(t,e),children:(0,N.jsx)(a.A,{sx:{fontSize:e.fontSize,fontFamily:e.fontFamily,color:e.color,fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:e.align,width:"100%",pointerEvents:"none"},children:e.text})}));case Ae.IMAGE:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%"},onMouseDown:t=>Mt(t,e),children:(0,N.jsx)("img",{src:e.src,alt:"",crossOrigin:"anonymous",style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"},draggable:!1})}));case Ae.RECTANGLE:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",backgroundColor:e.fill,border:"".concat(e.strokeWidth,"px solid ").concat(e.stroke),borderRadius:"4px"},onMouseDown:t=>Mt(t,e)}));case Ae.CIRCLE:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",backgroundColor:e.fill,border:"".concat(e.strokeWidth,"px solid ").concat(e.stroke),borderRadius:"50%"},onMouseDown:t=>Mt(t,e)}));case Ae.TRIANGLE:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",background:"transparent"},onMouseDown:t=>Mt(t,e),children:(0,N.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",preserveAspectRatio:"none",style:{pointerEvents:"none"},children:(0,N.jsx)("polygon",{points:"50,10 90,90 10,90",fill:e.fill,stroke:e.stroke,strokeWidth:e.strokeWidth})})}));case Ae.STAR:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",background:"transparent"},onMouseDown:t=>Mt(t,e),children:(0,N.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",style:{pointerEvents:"none"},children:(0,N.jsx)("polygon",{points:"50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40",fill:e.fill,stroke:e.stroke,strokeWidth:e.strokeWidth})})}));case Ae.LINE:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",background:"transparent"},onMouseDown:t=>Mt(t,e),children:(0,N.jsx)("svg",{width:"100%",height:"100%",style:{pointerEvents:"none"},children:(0,N.jsx)("line",{x1:"0",y1:"50%",x2:"100%",y2:"50%",stroke:e.stroke,strokeWidth:e.strokeWidth})})}));case Ae.ARROW:return s((0,N.jsx)(l.A,{sx:{width:"100%",height:"100%",background:"transparent"},onMouseDown:t=>Mt(t,e),children:(0,N.jsxs)("svg",{width:"100%",height:"100%",viewBox:"0 0 100 20",style:{pointerEvents:"none"},children:[(0,N.jsx)("defs",{children:(0,N.jsx)("marker",{id:"arrowhead-".concat(e.id),markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",children:(0,N.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:e.stroke})})}),(0,N.jsx)("line",{x1:"0",y1:"10",x2:"85",y2:"10",stroke:e.stroke,strokeWidth:e.strokeWidth,markerEnd:"url(#arrowhead-".concat(e.id,")")})]})}));default:return null}})(e))})})]}),(0,N.jsxs)(d.A,{sx:{width:260,display:"flex",flexDirection:"column",borderRadius:0,p:2,overflow:"auto"},children:[(0,N.jsx)(a.A,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Properties"}),Qt?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(a.A,{variant:"caption",color:"textSecondary",gutterBottom:!0,children:["Selected: ",Qt.type]}),(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Position & Size"}),(0,N.jsxs)(m.Ay,{container:!0,spacing:1,children:[(0,N.jsx)(m.Ay,{item:!0,xs:6,children:(0,N.jsx)(v.A,{size:"small",label:"X",type:"number",fullWidth:!0,value:Math.round(Qt.x),onChange:e=>Gt(Qt.id,{x:parseInt(e.target.value)||0})})}),(0,N.jsx)(m.Ay,{item:!0,xs:6,children:(0,N.jsx)(v.A,{size:"small",label:"Y",type:"number",fullWidth:!0,value:Math.round(Qt.y),onChange:e=>Gt(Qt.id,{y:parseInt(e.target.value)||0})})}),(0,N.jsx)(m.Ay,{item:!0,xs:6,children:(0,N.jsx)(v.A,{size:"small",label:"Width",type:"number",fullWidth:!0,value:Math.round(Qt.width),onChange:e=>Gt(Qt.id,{width:parseInt(e.target.value)||10})})}),(0,N.jsx)(m.Ay,{item:!0,xs:6,children:(0,N.jsx)(v.A,{size:"small",label:"Height",type:"number",fullWidth:!0,value:Math.round(Qt.height),onChange:e=>Gt(Qt.id,{height:parseInt(e.target.value)||10})})})]}),(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Rotation"}),(0,N.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,N.jsx)(S.Ay,{size:"small",value:Qt.rotation||0,min:0,max:360,onChange:(e,t)=>Gt(Qt.id,{rotation:t})}),(0,N.jsxs)(a.A,{variant:"caption",children:[Qt.rotation||0,"\xb0"]})]}),(0,N.jsxs)(l.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Xt(Qt.id,-15),children:"-15\xb0"}),(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Xt(Qt.id,15),children:"+15\xb0"}),(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Xt(Qt.id,90),children:"+90\xb0"})]}),Qt.type===Ae.IMAGE&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Image Options"}),(0,N.jsx)(a.A,{variant:"caption",color:"textSecondary",sx:{display:"block",mb:1},children:"Drag corners to resize, or use a shape as mask:"}),(0,N.jsx)(c.A,{size:"small",variant:"outlined",fullWidth:!0,onClick:()=>{const e=Me.filter(e=>[Ae.RECTANGLE,Ae.CIRCLE,Ae.TRIANGLE,Ae.STAR].includes(e.type));if(e.length>0){const t=e[e.length-1];Gt(Qt.id,{x:t.x,y:t.y,width:t.width,height:t.height}),at({open:!0,message:"Image fitted to shape!",severity:"success"})}else at({open:!0,message:"Add a shape first to fit the image into",severity:"info"})},sx:{mb:1},children:"Fit to Last Shape"}),(0,N.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Gt(Qt.id,{width:100,height:100}),children:"100x100"}),(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Gt(Qt.id,{width:150,height:150}),children:"150x150"}),(0,N.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>Gt(Qt.id,{width:200,height:200}),children:"200x200"})]})]}),Qt.type===Ae.TEXT&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Text"}),(0,N.jsx)(v.A,{size:"small",fullWidth:!0,multiline:!0,rows:2,value:Qt.text,onChange:e=>Gt(Qt.id,{text:e.target.value}),sx:{mb:1}}),(0,N.jsxs)(g.A,{size:"small",fullWidth:!0,sx:{mb:1},children:[(0,N.jsx)(E.A,{children:"Font"}),(0,N.jsx)(p.A,{value:Qt.fontFamily,label:"Font",onChange:e=>Gt(Qt.id,{fontFamily:e.target.value}),children:je.map(e=>(0,N.jsx)(A.A,{value:e,sx:{fontFamily:e},children:e},e))})]}),(0,N.jsx)(v.A,{size:"small",label:"Size",type:"number",value:Qt.fontSize,onChange:e=>Gt(Qt.id,{fontSize:parseInt(e.target.value)||12}),sx:{mb:1}}),(0,N.jsxs)(l.A,{sx:{display:"flex",gap:.5,mb:1},children:[(0,N.jsx)(L.A,{size:"small",value:"bold",selected:Qt.bold,onChange:()=>Gt(Qt.id,{bold:!Qt.bold}),children:(0,N.jsx)(re,{})}),(0,N.jsx)(L.A,{size:"small",value:"italic",selected:Qt.italic,onChange:()=>Gt(Qt.id,{italic:!Qt.italic}),children:(0,N.jsx)(oe,{})}),(0,N.jsx)(L.A,{size:"small",value:"left",selected:"left"===Qt.align,onChange:()=>Gt(Qt.id,{align:"left"}),children:(0,N.jsx)(le,{})}),(0,N.jsx)(L.A,{size:"small",value:"center",selected:"center"===Qt.align,onChange:()=>Gt(Qt.id,{align:"center"}),children:(0,N.jsx)(ae,{})}),(0,N.jsx)(L.A,{size:"small",value:"right",selected:"right"===Qt.align,onChange:()=>Gt(Qt.id,{align:"right"}),children:(0,N.jsx)(ce,{})})]}),(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:1},children:"Text Color"}),(0,N.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:fe.slice(0,12).map(e=>(0,N.jsx)(l.A,{sx:{width:20,height:20,bgcolor:e,cursor:"pointer",border:Qt.color===e?"2px solid #000":"1px solid #ccc"},onClick:()=>Gt(Qt.id,{color:e})},e))})]}),[Ae.RECTANGLE,Ae.CIRCLE,Ae.TRIANGLE,Ae.STAR].includes(Qt.type)&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Colors"}),(0,N.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,N.jsx)(a.A,{variant:"caption",sx:{width:40},children:"Fill:"}),(0,N.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:fe.slice(0,12).map(e=>(0,N.jsx)(l.A,{sx:{width:20,height:20,bgcolor:e,cursor:"pointer",border:Qt.fill===e?"2px solid #000":"1px solid #ccc"},onClick:()=>Gt(Qt.id,{fill:e})},e))})]}),(0,N.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,N.jsx)(a.A,{variant:"caption",sx:{width:40},children:"Stroke:"}),(0,N.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:fe.slice(0,12).map(e=>(0,N.jsx)(l.A,{sx:{width:20,height:20,bgcolor:e,cursor:"pointer",border:Qt.stroke===e?"2px solid #000":"1px solid #ccc"},onClick:()=>Gt(Qt.id,{stroke:e})},e))})]})]}),[Ae.LINE,Ae.ARROW].includes(Qt.type)&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(a.A,{variant:"subtitle2",sx:{mt:2},children:"Line Color"}),(0,N.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,N.jsx)(a.A,{variant:"caption",sx:{width:40},children:"Color:"}),(0,N.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:fe.slice(0,12).map(e=>(0,N.jsx)(l.A,{sx:{width:20,height:20,bgcolor:e,cursor:"pointer",border:Qt.stroke===e?"2px solid #000":"1px solid #ccc"},onClick:()=>Gt(Qt.id,{stroke:e})},e))})]})]}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsx)(a.A,{variant:"subtitle2",children:"Actions"}),(0,N.jsxs)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:[(0,N.jsx)(z.A,{title:"Bring to Front",children:(0,N.jsx)(y.A,{size:"small",onClick:()=>(e=>{const t=Me.find(t=>t.id===e);if(t){const s=[...Me.filter(t=>t.id!==e),t];De(s),Rt(s)}})(Qt.id),children:(0,N.jsx)(de,{})})}),(0,N.jsx)(z.A,{title:"Send to Back",children:(0,N.jsx)(y.A,{size:"small",onClick:()=>(e=>{const t=Me.find(t=>t.id===e);if(t){const s=[t,...Me.filter(t=>t.id!==e)];De(s),Rt(s)}})(Qt.id),children:(0,N.jsx)(he,{})})}),(0,N.jsx)(z.A,{title:"Duplicate",children:(0,N.jsx)(y.A,{size:"small",onClick:()=>(e=>{const t=(0,i.A)((0,i.A)({},e),{},{id:"".concat(e.type,"-").concat(Date.now()),x:e.x+20,y:e.y+20}),s=[...Me,t];De(s),Ne(t),Rt(s)})(Qt),children:(0,N.jsx)(xe.A,{})})}),(0,N.jsx)(z.A,{title:Qt.locked?"Unlock":"Lock",children:(0,N.jsx)(y.A,{size:"small",onClick:()=>(e=>{const t=Me.find(t=>t.id===e);t&&Gt(e,{locked:!t.locked})})(Qt.id),children:Qt.locked?(0,N.jsx)(me,{}):(0,N.jsx)(ue,{})})}),(0,N.jsx)(z.A,{title:"Delete",children:(0,N.jsx)(y.A,{size:"small",color:"error",onClick:()=>Ut(Qt.id),children:(0,N.jsx)(Y.A,{})})})]})]}):(0,N.jsx)(a.A,{variant:"body2",color:"textSecondary",sx:{mt:2},children:"Select an element to edit its properties"}),(0,N.jsx)(l.A,{sx:{flex:1}}),(0,N.jsx)(u.A,{sx:{my:2}}),(0,N.jsxs)(a.A,{variant:"caption",color:"textSecondary",children:["Page Size: ",Kt.width," \xd7 ",Kt.height,"px",(0,N.jsx)("br",{}),"Elements: ",Me.length]})]}),(0,N.jsxs)(I.A,{open:ct,onClose:()=>dt(!1),children:[(0,N.jsx)(T.A,{children:"Save Design"}),(0,N.jsx)(W.A,{children:(0,N.jsx)(v.A,{fullWidth:!0,label:"Design Name",value:mt,onChange:e=>ut(e.target.value),sx:{mt:1}})}),(0,N.jsxs)(R.A,{children:[(0,N.jsx)(c.A,{onClick:()=>dt(!1),children:"Cancel"}),(0,N.jsx)(c.A,{variant:"outlined",onClick:async()=>{if(we&&be)if(mt.trim())try{const e="https://portal.myschoolct.com";if(!(await fetch("".concat(e,"/api/rest/templates/save"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(be)},body:JSON.stringify({name:mt,makerType:s,pageSize:ke,customSize:ze,canvasBg:Ee,elements:Me})})).ok)throw new Error("Failed to save design");await Tt(),dt(!1),ut(""),at({open:!0,message:"Design saved!",severity:"success"})}catch(e){console.error("Save error:",e),at({open:!0,message:"Failed to save design",severity:"error"})}else at({open:!0,message:"Please enter a design name",severity:"warning"});else at({open:!0,message:"Please login to save designs",severity:"warning"})},sx:{color:"#1976d2","&:hover":{color:"#000000",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Save"})]})]}),(0,N.jsxs)(I.A,{open:ht,onClose:()=>xt(!1),maxWidth:"sm",fullWidth:!0,children:[(0,N.jsx)(T.A,{children:"Load Design"}),(0,N.jsx)(W.A,{children:0===gt.length?(0,N.jsx)(a.A,{color:"textSecondary",children:"No saved designs found"}):(0,N.jsx)(f.A,{children:gt.map(e=>{var t;const s=e.created_at||e.createdAt;let i="";if(e.isSystem)i="System Template";else if(s)try{const e=new Date(s);i=isNaN(e.getTime())?"":e.toLocaleString()}catch(r){i=""}const n=e.isSystem||(null===(t=e.id)||void 0===t?void 0:t.toString().startsWith("seed-"));return(0,N.jsx)(j.Ay,{button:!0,onClick:()=>_t(e),secondaryAction:!n&&(0,N.jsx)(y.A,{edge:"end",onClick:t=>{t.stopPropagation(),Jt(e.id)},color:"error",size:"small",children:(0,N.jsx)(Y.A,{})}),children:(0,N.jsx)(w.A,{primary:e.name,secondary:"".concat(e.pageSize||"A4").concat(i?" \u2022 ".concat(i):""),primaryTypographyProps:{fontWeight:n?500:400}})},e.id)})})}),(0,N.jsx)(R.A,{children:(0,N.jsx)(c.A,{onClick:()=>xt(!1),children:"Cancel"})})]}),(0,N.jsx)(M.A,{open:lt.open,autoHideDuration:3e3,onClose:()=>at((0,i.A)((0,i.A)({},lt),{},{open:!1})),children:(0,N.jsx)(D.A,{severity:lt.severity,children:lt.message})})]})}),we=ye}}]);
//# sourceMappingURL=239.848c7ba3.chunk.js.map